CREATE TABLE resident (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    name VARCHAR2(100) NOT NULL,
    apartment VARCHAR2(20) NOT NULL,
    phone VARCHAR2(20),
    registered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE parking_spot (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    code VARCHAR2(20) UNIQUE NOT NULL,
    type VARCHAR2(10) CHECK (type IN ('CAR', 'MOTORBIKE')),
    status VARCHAR2(20) CHECK (status IN ('FREE', 'ASSIGNED', 'OCCUPIED', 'OUT_OF_SERVICE')),
    assigned_resident_id NUMBER,
    version NUMBER DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_assigned_resident FOREIGN KEY (assigned_resident_id)
        REFERENCES resident(id)
);
CREATE TABLE spot_history (
    id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    parking_spot_id NUMBER NOT NULL,
    changed_by VARCHAR2(100),
    change_type VARCHAR2(50),
    change_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_spot_history FOREIGN KEY (parking_spot_id)
        REFERENCES parking_spot(id)
);
